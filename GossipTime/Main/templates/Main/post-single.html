{% extends 'Main/base.html' %}
{% load static %}

{% block content %}
  <div class="container mt-5">
    <div class="row">
      <div class="col-lg-8">
        <div class="card mb-4">
          <div class="card-body">
            <div class="post-cat-box">
              <a href="javascript:void(0)">{{ post.category.name }}</a>
            </div>
            <h1 style="color:#404040 ;" class="card-title">{{ post.title }}</h1>
            <div class="blog-small-excerpt-box">
              <p>{{ post.excerpt }}</p>
            </div>
            <div class="post-bottom-meta-list post-meta-wrapper">
              <div class="post-left-details-meta">
                <div class="post-meta-author-box">
                  By <a href="#">{{ post.author }}</a>
                </div>
                <div class="post-meta-date-box">{{ post.publish_date|date:'M d' }}</div>
              </div>
              <div class="post-meta-social">
                <form method="post" action="{% url 'like' post.id %}" id="like-form">
                  {% csrf_token %}

                  <i class="fa-regular fa-thumbs-up"></i>
                  <span>{{ post.likes.count }}</span>
                </form>
                <form method="post" action="{% url 'dislike' post.id %}" id="dislike-form">
                  {% csrf_token %}

                  <i class="fa-solid fa-thumbs-down"></i> <span>{{ post.dislikes.count }}</span>
                </form>
              </div>
            </div>
            <div class="post-featured-image">
              <img src="{{ post.image.url }}" alt="Post Image" class="img-fluid" />
            </div>
            <p style="color: #A6A6A6;">{{ post.content }}</p>
          </div>
        </div>
        <div class="author-bio-wrap">
          <div class="author-thumbnail">
            <a href="#"><img src="{{ post.author.image.url }}" alt="Author" class="img-fluid" /></a>
          </div>
          <div class="author-body">
            <span class="subtitle">{{ post.author.position }}</span>
            <h5 class="title">{{ post.author.name }}</h5>
            <p class="author-inner-text">{{ post.author.bio }}</p>
            <div class="social-share-author">
              <a href="#"><i class="fab fa-facebook-f"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

<script>
  document.getElementById('like-form').addEventListener('submit', function (event) {
    event.preventDefault()
    const form = event.target
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form)
    }).then((response) => {
      if (response.ok) {
        location.reload()
      }
    })
  })
</script>
